# Introduction to operator overloading

8.9 函数重载中学到了函数的重载提供了一种机制来创建和解析函数调用同名的不同函数，其中只需要每个函数都有一个独特的函数原型。这允许用户创建函数的变体用于应对不同的数据类型，而无需为每一种变体进行独特的命名。

C++ 中操作符的实现如同函数。通过函数重载的方式来重载操作符函数，可以自定义操作符用作于不同的数据类型（包括用户自己的类）。使用函数重载来重载操作符被称为**操作符重载**。

## 操作符作为函数

思考以下例子：

```cpp
int x { 2 };
int y { 3 };
std::cout << x + y << '\n';
```

编译器使用了内建版本的操作符（+）来进行整型运算 -- 该函数使整数 x 与 y 相加并返回一个整数结果。当看见表达式 `x + y` 时，可以在脑海中转换成函数调用 `operator+(x, y)`（其中 operator+ 是函数的名称）。

## 解析重载操作符

当解析一个包含操作符的表达式时，编译器使用以下规则：

- 如果*所有的*运算是基础的数据类型，编译器会调用内建的操作符函数，如果该函数不存在，编译器则产生编译错误。
- 如果*任意的*运算时用户数据类型（例如，用户的类，或者枚举类），编译器将查看类型是否有匹配的重载操作符函数可以被调用。如果不能找到，则尝试转换一个或多个用户定义类型的运算成基础数据类型，以便使用匹配的内建操作符（通过重载类型强转，下一节讲详细讲述）。如果还是失败了，则产生变异错误。

## 操作符重载的限制是什么？

首先，C++ 中几乎任何存在的操作符都可以被重载。除了：条件判断符（?:），sizeof，作用于（::），成员选择符（.），指针成员选择符（.\*），typeid，以及强转操作符。

其次，仅可以重载已存在的操作符。不可以创建新的符号或者对已有操作符重命名。例如不可以创建一个符号 \*\* 来做指数计算。

第三，重载操作符中的运算至少有一个必须是用户定义类型。这就意味着不可以重载加法操作符来进行 int 与 double 相加。然而可以重载加法操作符来进行 int 与 Mystring 的相加。

第四，不可以修改操作符支持的运算数量。

最后，所有的操作符维持其默认的优先级与结合律（无论它们做什么），这是不可变的。

一些新手程序员尝试重载位运算符 XOR 操作符（^）来做指数计算。然而 C++ 中操作符^ 相较于基础计算操作符，拥有一个更低级的优先级，这就导致运算的解析错误。

因为有优先级的问题，最好的办法就是在操作符原有的意图上进行重载。

最佳实践：当重载操作符时，最好是维持操作符原有的意图。

此外，因为操作符并没有描述性的名称，其意图往往不是很清楚。例如，操作符+ 对于字符串类型的拼接是合理的，但是操作符- 呢？它的意图是不清晰的。

最佳实践：如果重载的操作符其意义是不清晰且符合直觉的，那么应该使用命名函数。
